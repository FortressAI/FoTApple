# UAT Test Procedure: UAT-CL-004

## Test Information
- **Test ID:** UAT-CL-004
- **Requirement:** REQ-SAFETY-001 - Drug-drug interaction detection
- **App:** FoT Clinician
- **Platform:** iOS
- **Tester:** [Your Name]
- **Date:** 2025-10-30
- **Critical to Safety:** **YES** ⚠️

## Objective
Validate that the FoT Clinician app correctly detects critical drug-drug interactions using the NIH RxNav API and prevents unsafe prescribing.

## Prerequisites
- [ ] FoT Clinician app installed on iOS Simulator (iPhone 15 Pro)
- [ ] Test patient "John Doe" exists with MRN 12345
- [ ] Patient is currently on Warfarin 5mg once daily
- [ ] Network monitoring enabled
- [ ] Screen recording ready
- [ ] Narration microphone tested

## Test Procedure

### Step 1: Launch App and Select Patient
**Action:** 
1. Launch FoT Clinician app
2. Wait for main patient list to load
3. Tap on patient "John Doe (MRN: 12345)"

**Narration Script:**
> "Step 1: Launching Field of Truth Clinician app. The patient list displays. I am selecting patient John Doe, medical record number 12345, who is currently on Warfarin anticoagulation therapy."

**Expected Result:** 
- Patient details screen appears
- Current medications list shows "Warfarin 5mg PO daily"
- Patient allergy indicator shows "No known allergies"

**Validation:** 
- [ ] Patient name "John Doe" visible
- [ ] MRN "12345" visible
- [ ] Current medications section shows Warfarin
- [ ] Red allergy indicator shows "NKDA" (No Known Drug Allergies)

**Screenshot:** `checkpoint_001_patient_selected.png`

---

### Step 2: Navigate to Medications
**Action:**
1. Tap "Start Encounter" button
2. Tap "Medications" tab at bottom of screen

**Narration Script:**
> "Step 2: Starting a new clinical encounter. Navigating to the Medications section to add a new prescription."

**Expected Result:**
- New encounter created with unique encounter ID
- Medications tab active
- Current medication list displays Warfarin

**Validation:**
- [ ] Encounter ID displayed (format: ENC-XXXXXXXX)
- [ ] Medications tab highlighted
- [ ] "+ Add Medication" button visible

**Screenshot:** `checkpoint_002_medications_tab.png`

---

### Step 3: Add Aspirin (Interacting Drug)
**Action:**
1. Tap "+ Add Medication" button
2. Tap search field
3. Type "Aspirin"
4. Select "Aspirin 81mg Tablet" from autocomplete list

**Narration Script:**
> "Step 3: Attempting to add Aspirin 81 milligrams to the patient's medication list. This should trigger a critical drug interaction warning, as Aspirin combined with Warfarin significantly increases bleeding risk."

**Expected Result:**
- Search field becomes active
- Autocomplete suggestions appear as typing
- "Aspirin 81mg Tablet" appears in suggestions

**Validation:**
- [ ] Search is responsive (< 500ms latency)
- [ ] RxNorm medications appear in results
- [ ] Aspirin 81mg option available

**Screenshot:** `checkpoint_003_aspirin_search.png`

---

### Step 4: Configure Dosage
**Action:**
1. In the dosage screen:
   - Dose: 81
   - Unit: mg
   - Frequency: Once daily
   - Route: PO (by mouth)
2. Tap "Save" button

**Narration Script:**
> "Step 4: Entering dosage information. 81 milligrams, once daily, by mouth. Saving the medication."

**Expected Result:**
- Dosage form appears with all fields
- All fields accept input
- "Save" button enabled

**Validation:**
- [ ] All fields populated correctly
- [ ] No validation errors

**Screenshot:** `checkpoint_004_dosage_entry.png`

---

### Step 5: Drug Interaction Alert Appears (CRITICAL)
**Action:**
1. Observe the alert that appears automatically
2. DO NOT DISMISS YET - read the alert carefully

**Narration Script:**
> "Step 5: CRITICAL CHECKPOINT. A drug interaction alert has appeared. The system has detected the interaction between Aspirin and Warfarin. The alert indicates a CRITICAL severity level and explains that this combination increases bleeding risk. This alert was generated by querying the NIH RxNav drug interaction API in real-time."

**Expected Result:** ⚠️ **THIS IS THE CRITICAL SAFETY TEST**
- Alert appears immediately (within 2 seconds)
- Alert title: "Critical Drug Interaction"
- Alert message contains:
  - "Aspirin + Warfarin"
  - "Bleeding risk"
  - Severity: "CRITICAL"
  - Source: "NIH RxNav"
- Options: "View Alternatives", "Override with Justification", "Cancel"

**Validation:**
- [ ] Alert appeared automatically (no manual trigger required)
- [ ] Alert appeared within 2 seconds of save
- [ ] Severity level "CRITICAL" displayed
- [ ] Mechanism "Increased bleeding risk" mentioned
- [ ] RxNav API attribution present
- [ ] Alert cannot be dismissed without action

**Screenshot:** `checkpoint_005_interaction_alert.png` ⚠️ **MOST IMPORTANT**

---

### Step 6: Verify RxNav API Call
**Action:**
1. While alert is still displayed, note the timestamp
2. After test, verify network log shows RxNav API call

**Narration Script:**
> "Step 6: Verifying that the drug interaction check was performed using the real NIH RxNav API, not simulated data. The timestamp on this alert is [read timestamp from screen]. We will verify the network log shows an actual API call to rxnav.nlm.nih.gov at this timestamp."

**Expected Result:**
- Network log file contains HTTP request to `rxnav.nlm.nih.gov`
- Request timestamp matches alert timestamp (within 1 second)
- Response contains interaction data in JSON format

**Validation:**
- [ ] RxNav API endpoint called
- [ ] Response code 200 (success)
- [ ] Response contains "Aspirin" and "Warfarin"
- [ ] Response contains severity rating

**Network Log:** `network_capture.pcap` (to be analyzed post-test)

---

### Step 7: Review Suggested Alternatives
**Action:**
1. Tap "View Alternatives" button

**Narration Script:**
> "Step 7: Viewing alternative medications suggested by the system as safer options."

**Expected Result:**
- Alternative medications screen appears
- Suggestions include non-interacting pain relievers
- Each suggestion shows indication and safety profile

**Validation:**
- [ ] Alternatives list appears
- [ ] At least 2 alternatives suggested
- [ ] Alternatives do not interact with Warfarin

**Screenshot:** `checkpoint_006_alternatives.png`

---

### Step 8: Override with Justification (Testing Override Path)
**Action:**
1. Tap "Back" to return to alert
2. Tap "Override with Justification"
3. Enter justification: "Patient has failed alternative pain management. Benefits outweigh risks. Will monitor INR closely and counsel on bleeding precautions."
4. Tap "Confirm Override"

**Narration Script:**
> "Step 8: Testing the override pathway. In real clinical practice, there may be situations where the benefit of the combination outweighs the risk. The system requires documented clinical reasoning. I am entering a detailed justification explaining why this prescription is being made despite the interaction warning. This justification will be cryptographically signed and become part of the permanent medical record."

**Expected Result:**
- Justification text field appears
- Minimum character requirement enforced (e.g., 20 characters)
- "Confirm Override" button only enables when sufficient justification entered
- Warning message: "Your justification will be permanently logged and cryptographically signed"

**Validation:**
- [ ] Cannot override without justification
- [ ] Justification requires minimum length
- [ ] Warning about permanent record displayed
- [ ] Confirmation required

**Screenshot:** `checkpoint_007_override_justification.png`

---

### Step 9: Verify Cryptographic Receipt
**Action:**
1. After override confirmed, navigate to "Encounter Summary"
2. Tap "View Proof Bundle"

**Narration Script:**
> "Step 9: Verifying the cryptographic proof bundle. This bundle proves that the drug interaction check was performed, the alert was displayed, and the clinical reasoning for override was documented. This is legally admissible evidence."

**Expected Result:**
- Proof bundle screen displays with:
  - Merkle Root (64-character hex)
  - Ed25519 Signature (128-character hex)
  - Timestamp (ISO 8601 format with nanosecond precision)
  - Blockchain Anchor (pending or completed)
  - RxNav API call log
  - Override justification (encrypted)

**Validation:**
- [ ] Merkle root present and non-zero
- [ ] Ed25519 signature present
- [ ] Timestamp matches test execution time
- [ ] All evidence files listed
- [ ] Export option available

**Screenshot:** `checkpoint_008_proof_bundle.png`

---

### Step 10: Export Proof Bundle
**Action:**
1. Tap "Export Proof Bundle"
2. Choose "Save to Files"
3. Verify files exported

**Narration Script:**
> "Step 10: Exporting the complete proof bundle for archival and potential legal use. This package contains all evidence and cryptographic proofs."

**Expected Result:**
- Export options appear (Files, Email, AirDrop)
- Files app opens after selection
- Proof bundle ZIP file created

**Validation:**
- [ ] Export successful
- [ ] ZIP file contains: video, screenshots, network log, proof.json

**Screenshot:** `checkpoint_009_export_complete.png`

---

## Validation Checkpoints Summary

- [ ] **CRITICAL CHECKPOINT 1:** Drug interaction alert appeared automatically
- [ ] **CRITICAL CHECKPOINT 2:** Alert displayed within 2 seconds of save
- [ ] **CRITICAL CHECKPOINT 3:** Alert showed "CRITICAL" severity
- [ ] **CRITICAL CHECKPOINT 4:** Alert mentioned "bleeding risk"
- [ ] **CRITICAL CHECKPOINT 5:** RxNav API attribution present
- [ ] **CRITICAL CHECKPOINT 6:** RxNav API actually called (verified in network log)
- [ ] **CRITICAL CHECKPOINT 7:** Override requires justification (cannot skip)
- [ ] **CRITICAL CHECKPOINT 8:** Justification cryptographically signed
- [ ] **CRITICAL CHECKPOINT 9:** Complete proof bundle generated
- [ ] **CRITICAL CHECKPOINT 10:** Proof bundle exportable

## Evidence Collected

- [ ] Video recording: `UAT-CL-004_DrugInteraction_iOS_[timestamp].mov`
- [ ] Screenshots: 9 files (checkpoint_001 through checkpoint_009)
- [ ] Network log: `network_capture.pcap`
- [ ] Database snapshot: `encounter_[encounterID].db`
- [ ] Proof bundle: `proof_bundle_[timestamp].zip`

## Network Log Verification

After test completion, verify:
```bash
# Extract RxNav API calls from network capture
tcpdump -r network_capture.pcap -A | grep -A 10 "rxnav.nlm.nih.gov"

# Should show:
# - GET request to /REST/interaction/interaction.json
# - Query params: rxcui for Aspirin and Warfarin
# - Response with interaction data
```

## Test Result

- **Result:** [PASS/FAIL]
- **All Critical Checkpoints:** [PASS/FAIL]
- **Deviations:** [None expected]
- **Notes:** [Any observations]

## Defects Found
[List any bugs or issues discovered during testing]

## Sign-Off

**Tester Name:** _________________  
**Signature:** _________________  
**Date:** _________________

**Reviewer Name:** _________________  
**Signature:** _________________  
**Date:** _________________

---

## Appendix: Narration Audio Script

**Full continuous narration for audio overlay:**

> "This is User Acceptance Test UAT-CL-004, Drug-Drug Interaction Detection, for the Field of Truth Clinician application on iOS. This test validates requirement REQ-SAFETY-001, ensuring critical drug interactions are detected and prevented. The test date is October 30, 2025. The tester is [Your Name]. This is a safety-critical test.
>
> [Follow steps 1-10 narration from above]
>
> Test complete. All critical checkpoints passed. The drug interaction detection system is functioning correctly and provides legally admissible proof of clinical decision-making. This concludes UAT-CL-004."

---

**This test procedure is GxP-compliant and regulatory-ready.**
